name: Horusec SAST Action
description: Run Horusec SAST scan
author: sean.smith [B00158319@mytudublin.ie]

inputs:
  artifact-name:
    description: Name of the artifact to upload
    type: string
    required: false
    default: sast-horusec-report

  path:
    description: Directory to run the action
    type: string
    required: false
    default: ${{ github.workspace }}

runs:
  using: composite
  steps:
    - name: Check For File Existence
      uses: andstor/file-existence-action@v3
      with:
        files: ${{ inputs.path }}
        fail: true

    - name: Perform Horusec Analysis
      uses: fike/horusec-action@v0.2.2
      with:
        arguments: >
          --project-path=${{ inputs.path }}/ 
          --ignore="**/test/**" 
          --output-format=json 
          --json-output-file=horusec-report.json 
          --enable-owasp-dependency-check=true 
          --enable-shellcheck=true 
          --return-error=false

    - name: Upload Horusec Report
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.artifact-name }}
        path: horusec-report.json
        if-no-files-found: error
