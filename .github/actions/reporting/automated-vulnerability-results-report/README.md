# Automated Vulnerability Results Report Action

## Description

An action to create a CSV report for the following security testing tools based on their JSON reports.

**Notes:**
- The action will only create a CSV report if the JSON report exists.
- Scanning of each available security tool is optional, and is dependent on Workflow inputs supplied.
- SonarQube API requires a User Token. See [SonarQube Documentation](https://docs.sonarsource.com/sonarqube/9.9/user-guide/user-account/generating-and-using-tokens/) for more information.

**API Rate Limiting Notes:**
- The action uses the NVD API to acquire additional information about CVE vulnerabilities for SCA reports.
    - NVD API is rate limited to 50 requests in a rolling 30 second window. The action caches CVE details to reduce the number of requests made.
- The action uses the OpenCVE API to acquire additional information about CWE vulnerabilities for SAST reports.
  - OpenCVE API is rate limited to 100 requests per minute. The action caches CWE details to reduce the number of requests made.

**GitHub Notes:**
- The action uses the GitHub API to acquire CodeQL results.
  - OAuth app tokens and personal access tokens need the `security_events` scope for private or public repositories, or the `public_repo` scope for public repositories only.
- The action requires Dependabot alerts to enabled in the repository to generate Dependabot CSV reports.
  - There is no CLI available to generate Dependabot JSON reports, and functionality is embedded in the GitHub UI.

## Supported Security Testing Tools

| Security Testing Tool Type | Security Testing Tool Name |
|----------------------------|----------------------------|
| SAST                       | CodeQL                     |
| SAST                       | Horusec                    |
| SAST                       | Semgrep                    |
| SAST                       | Snyk Code                  |
| SAST                       | SonarQube                  |
| SCA                        | Dependabot                 |
| SCA                        | Grype                      |
| SCA                        | Snyk                       |
| SCA                        | OWASP Dependency Check     |

## Inputs

| name                                               | required | type    | default                                             | description                                        |
|----------------------------------------------------|----------|---------|-----------------------------------------------------|----------------------------------------------------|
| **nvd-api-key**                                    | true     | string  |                                                     | API Key to access the NVD API                      |
| **opencve-username**                               | true     | string  |                                                     | Username to query OpenCVE API                      |
| **opencve-password**                               | true     | string  |                                                     | Password to query OpenCVE API                      |
| **github-token**                                   | true     | string  |                                                     | Token to access the GitHub API                     |
| **github-organisation**                            | false    | string  |                                                     | Organisation name in GitHub                        |
| **github-repository**                              | false    | string  |                                                     | Repository name in GitHub                          |
| **sonarqube-url**                                  | false    | string  |                                                     | Hostname of SonarQube                              |
| **sonarqube-token**                                | false    | string  |                                                     | Token for querying SonarQube API                   |
| **sonarqube-project-key**                          | false    | string  |                                                     | Project key being scanned by SonarQube             |
| **sast-codeql-csv-result-filename**                | false    | string  | sast-codeql-vulnerability-result.csv                | Name of CodeQL CSV result filename                 |
| **sast-horusec-report-filename**                   | false    | string  |                                                     | Name of Horusec report filename                    |
| **sast-horusec-csv-result-filename**               | false    | string  | sast-horusec-vulnerability-result.csv               | Name of Horusec CSV result filename                |
| **sast-semgrep-report-filename**                   | false    | string  |                                                     | Name of Semgrep report filename                    |
| **sast-semgrep-csv-result-filename**               | false    | string  | sast-semgrep-vulnerability-result.csv               | Name of Semgrep CSV result filename                |
| **sast-snyk-code-report-filename**                 | false    | string  |                                                     | Name of Snyk Code report filename                  |
| **sast-snyk-code-csv-result-filename**             | false    | string  | sast-snyk-code-vulnerability-result.csv             | Name of Snyk Code CSV result filename              |
| **sast-sonarqube-csv-result-filename**             | false    | string  | sast-sonarqube-vulnerability-result.csv             | Name of SonarQube CSV result filename              |
| **sca-dependabot-csv-result-filename**             | false    | string  | sca-dependabot-vulnerability-result.csv             | Name of Dependabot CSV result filename             |
| **sca-grype-report-filename**                      | false    | string  |                                                     | Name of Grype report filename                      |
| **sca-grype-csv-result-filename**                  | false    | string  | sca-grype-vulnerability-result.csv                  | Name of Grype CSV result filename                  |
| **sca-snyk-report-filename**                       | false    | string  |                                                     | Name of Snyk report filename                       |
| **sca-snyk-csv-result-filename**                   | false    | string  | sca-snyk-vulnerability-result.csv                   | Name of Snyk CSV result filename                   |
| **sca-owasp-dependency-check-report-filename**     | false    | string  |                                                     | Name of OWASP Dependency Check report filename     |
| **sca-owasp-dependency-check-csv-result-filename** | false    | string  | sca-owasp-dependency-check-vulnerability-result.csv | Name of OWASP Dependency Check CSV result filename |
| **artifact-name**                                  | false    | string  | automated-vulnerability-results-report              | Name of the artifact to upload                     |
| **include-unit-tests**                             | false    | boolean | false                                               | Whether to run action unit tests                   |

## Build Artifacts

The following build artifact is uploaded to the GitHub Actions workflow run. This can be changed using the `artifact-name` input.
- `automated-vulnerability-results-report`

## Example Execution

```yaml
- name: Create Automated Vulnerability Results Report
  uses: seansmith39/H6060-Experiment-Resources/.github/actions/reporting/automated-vulnerability-results-report@main
  with:
    nvd-api-key: 11111111-2222-3333-4444-555555555555
    opencve-username: my-username
    opencve-password: my-password
    github-token: ${{ secrets.GITHUB_TOKEN }}
    github-organisation: my-organisation
    github-repository: my-repository    
    sonarqube-url: https://my-sonarqube-instance.com
    sonarqube-token: my-token
    sonarqube-project-key: my-project
    sast-horusec-report-filename: sast-horusec-report/horusec-report.json
    sast-semgrep-report-filename: sast-semgrep-report/semgrep-report.json
    sast-snyk-code-report-filename: sast-snyk-code-report/snyk-code-report.json
    sca-grype-report-filename: sca-grype-report/grype-report.json
    sca-snyk-report-filename: sca-snyk-report/snyk-report.json
    sca-owasp-dependency-check-report-filename: sca-owasp-dependency-check-report/owasp-dependency-check-report.json
```

## Action Unit Tests

To run the action unit tests, set the `include-unit-tests` input to `true`.

## CSV Report

A report is generated in the root directory of the repository for each security testing tool and is uploaded as a build artifact.

The generated report contains the following columns.

### SCA Reports

| Name                   | Description                                            | 
|------------------------|--------------------------------------------------------|
| Tool Type              | Type of security testing tool                          |               
| Tool Name              | Name of security testing tool                          |           
| Tool Version           | Version of security testing tool                       |
| Tool Classification    | Classification of security testing tool                |
| Language               | Programming language associated with vulnerability     |
| Severity               | Severity of reported vulnerability                     |
| Confidence             | Confidence of vulnerability accuracy                   |
| Component Type         | Type of component associated with vulnerability        |
| Component Name         | Name of component associated with vulnerability        |
| Component Version      | Version of component associated with vulnerability     |
| Component PURL         | Package URL of component associated with vulnerability |
| Component License      | License of component associated with vulnerability     |
| Component Location     | Location of component associated with vulnerability    |
| CVE ID                 | CWE ID                                                 |
| CVE Description        | CVE description                                        |
| CVE Source             | Organisation who reported CVE                          |
| CVE Published Date     | Date CVE was published                                 |
| CVE Last Modified Date | Date CVE was last modified                             |
| CVE Status             | Current status of vulnerability                        |
| CVE Malicious          | Whether CVE is malicious                               |
| CVE Disputed           | Whether CVE is disputed                                |
| CVSS V2 Vector         | CVSS V2 metrics                                        |
| CVSS V3 Vector         | CVSS V3.1 or V3 metrics                                |
| CVSS V4 Vector         | CVSS V2 metrics                                        |
| CWE ID                 | CWE ID                                                 |

### SAST Reports

| Name                | Description                                        | 
|---------------------|----------------------------------------------------|
| Tool Type           | Type of security testing tool                      |               
| Tool Name           | Name of security testing tool                      |           
| Tool Version        | Version of security testing tool                   |
| Tool Classification | Classification of security testing tool            |
| Language            | Programming language associated with vulnerability |
| Severity            | Severity of reported vulnerability                 |
| Confidence          | Confidence of vulnerability accuracy               |
| CWE ID              | CWE ID                                             |
| CWE Name            | CWE Name                                           |
| CWE Description     | CWE Description                                    |
| CWE Impact          | Impact rating of CWE                               |
| CWE Likelihood      | Likelihood of CWE exploitation                     |
| OWASP Top 10        | Category of OWASP top 10 for CWE ID                |
| MITRE Top 25        | Index of MITRE top 25 for CWE ID                   |
| Rule ID             | Rule id associated with vulnerability              |
| File                | File associated with vulnerability                 |
| Line                | Line number associated with vulnerability          |

## Resources

- [NVD API](https://csrc.nist.gov/Projects/Security-Content-Automation-Protocol/specifications/nvd)
- [OpenCVE API](https://opencve.io/docs)
- [GitHub API](https://docs.github.com/en/rest)
- [CodeQL](https://securitylab.github.com/tools/codeql)
- [Horusec](https://horusec.io/)
- [Semgrep](https://semgrep.dev/)
- [Snyk Code](https://snyk.io/product/snyk-code/)
- [SonarQube](https://www.sonarqube.org/)
- [Dependabot](https://dependabot.com/)
- [Grype](https://github.com/anchore/grype)
- [Snyk](https://snyk.io/)
- [OWASP Dependency Check](https://owasp.org/www-project-dependency-check/)
