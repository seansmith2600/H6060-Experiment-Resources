name: Test Snyk Code SAST Action

on:
  workflow_dispatch:

permissions:
  security-events: write

jobs:
  test-action-java:
    name: Test Snyk Code SAST Action (Java)
    runs-on: ubuntu-22.04
    env:
      SNYK_TOKEN: ${{ secrets.TEST_SNYK_TOKEN }}
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          path: experiment-resources

      - name: Checkout Jackson-Databind Repository
        uses: actions/checkout@v4
        with:
          repository: seansmith39/H6060-Java-Jackson-Databind
          ref: 1acb8ffe6eb20005114bfe18cfd5809b443789c2
          path: jackson-databind

      - name: Run Snyk Code (SAST)
        uses: ./experiment-resources/.github/actions/sast/snyk-code
        with:
          artifact-name: sast-snyk-code-report-java
          path: jackson-databind

  test-action-python:
    name: Test Snyk Code SAST Action (Python)
    runs-on: ubuntu-22.04
    env:
      SNYK_TOKEN: ${{ secrets.TEST_SNYK_TOKEN }}
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          path: experiment-resources

      - name: Checkout Pillow Repository
        uses: actions/checkout@v4
        with:
          repository: seansmith39/H6060-Python-Pillow
          ref: 722b5d3350fbbb599fd3966e08e55547a2656cd7
          path: pillow

      - name: Run Snyk Code (SAST)
        uses: ./experiment-resources/.github/actions/sast/snyk-code
        with:
          artifact-name: sast-snyk-code-report-python
          path: pillow

  test-action-javascript:
    name: Test Snyk Code SAST Action (JavaScript)
    runs-on: ubuntu-22.04
    env:
      SNYK_TOKEN: ${{ secrets.TEST_SNYK_TOKEN }}
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          path: experiment-resources

      - name: Checkout Lodash Repository
        uses: actions/checkout@v4
        with:
          repository: lodash/lodash
          ref: 1144918f3578a84fcc4986da9b806e63a6175cbb
          path: lodash

      - name: Run Snyk Code (SAST)
        uses: ./experiment-resources/.github/actions/sast/snyk-code
        with:
          artifact-name: sast-snyk-code-report-javascript
          path: lodash
